# 市场情绪周期监控系统

基于tushare数据构建的市场情绪周期可视化工具，支持每日增量更新和历史数据分析。

## 功能特性

- ✅ 市场基础数据：上涨/下跌家数、涨停/跌停数、涨跌5%统计
- ✅ 连板统计：首板、二板、三板、三板以上、最高板
- ✅ 晋级率分析：1进2、2进3、3板以上晋级率
- ✅ 高阶指标：反包涨停、涨停金额、封单金额
- ✅ 红盘率与溢价：首板/二板/三板以上的红盘率和溢价
- ✅ 炸板统计：炸板数、炸板率
- ✅ Web可视化：表格展示、颜色标记、日期筛选、Excel导出
- ✅ 增量更新：自动检测缺失数据并补充

## 目录结构

```
情绪周期表/
├── config.py              # 配置文件（tushare token等）
├── data_fetcher.py        # 数据获取模块
├── indicators.py          # 指标计算模块
├── update_data.py         # 数据更新脚本
├── app.py                 # Flask Web服务
├── data/                  # 数据存储目录
│   ├── raw/              # 原始数据（Parquet格式）
│   └── processed/        # 处理后数据
├── static/                # 静态资源
│   ├── css/
│   └── js/
├── templates/             # HTML模板
│   └── index.html
├── requirements.txt       # 依赖包
└── README.md             # 本文件
```

## 安装与配置

### 1. 安装依赖

```bash
pip install -r requirements.txt
```

### 2. 配置tushare token

在 `config.py` 中已配置好token，无需修改。

### 3. 初始化数据

首次运行，获取从2026-01-01至今的历史数据：

```bash
python update_data.py --init
```

### 4. 启动Web服务

```bash
python app.py
```

然后在浏览器访问：http://127.0.0.1:5000

## 使用说明

### 每日数据更新

收盘后（15:30之后）运行：

```bash
python update_data.py
```

脚本会自动检测缺失的交易日数据并补充。

### 补充历史数据

如需补充特定时段的历史数据：

```bash
python update_data.py --start 20250101 --end 20251231
```

### Web页面功能

- **日期筛选**：选择起止日期查看特定时段数据
- **列排序**：点击表头进行升序/降序排序
- **导出Excel**：点击"导出"按钮下载数据
- **颜色标记**：
  - 红色背景：正面指标（晋级率高、红盘率高等）
  - 绿色背景：负面指标（炸板率高、跌停多等）

## 数据说明

### 核心指标解释

- **涨停最高板**：当日涨停股票中连板数最多的
- **反包涨停**：最低价低于上日最低价但仍涨停的股票
- **涨停金额**：所有涨停股票的成交金额总和
- **封单金额**：所有涨停股票的封单金额总和
- **晋级率**：前一日N连板今日成功晋级为N+1连板的比例
- **红盘率**：收盘价≥开盘价的股票占比
- **溢价**：今日涨幅的平均值

## 技术架构

- **数据源**：Tushare Pro API
- **存储格式**：Parquet（高性能列式存储）
- **后端**：Flask
- **前端**：HTML + JavaScript + DataTables
- **数据处理**：Pandas + NumPy

## 注意事项

1. **积分要求**：需要tushare 5000+积分才能访问 `limit_list_d` 接口
2. **数据延迟**：tushare数据通常在收盘后15:30-16:00更新完成
3. **API限流**：脚本内置了调用延迟，避免触发限制
4. **时区**：所有日期均使用上海时区（UTC+8）

## 常见问题

**Q: 如何修改颜色标记规则？**

A: 编辑 `config.py` 中的 `COLOR_THRESHOLDS` 配置。

**Q: 数据更新失败怎么办？**

A: 检查网络连接和tushare token是否有效，确保有足够积分。

**Q: 如何设置定时自动更新？**

A: 使用Windows任务计划程序，每天15:35自动执行 `python update_data.py`。

## 版本历史

- v1.0.0 (2026-01-27) - 初始版本
